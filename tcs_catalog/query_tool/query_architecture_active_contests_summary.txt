select pcl.project_category_id as category_id
     , pcl.name as category_name
     , count(*) as total_contests
     --include both 1st and 2nd place
     , sum(pi.value::integer)*1.5 as total_prizes
  from project p
     , project_info pi
     , project_phase pp
     , project_category_lu pcl
 --    , project_info pic
 where p.project_status_id = 1
   and p.project_id = pi.project_id
   and pi.project_info_type_id = 16
   and p.project_id = pp.project_id
   and pp.phase_type_id = 2
   and pp.phase_status_id = 2
   and p.project_category_id = pcl.project_category_id
   and p.project_category_id = 7
--   and pic.project_id = p.project_id
--   and pic.project_info_type_id = 29
--   and pic.value = 'On'
   AND NOT EXISTS (SELECT 'has_eligibility_constraints' FROM contest_eligibility ce
       WHERE ce.is_studio = 0 AND ce.contest_id = p.project_id)
group by 1, 2;
