select  tcd.project_id, tcd.name as project_name, tcd.create_date, tcd.project_status_id, tcdpsl.name as project_status_name, tcd.project_forum_id as project_forum_id,

(select count(project_id) from project p where tc_direct_project_id = tcd.project_id and p.project_status_id = 2 and p.project_category_id != 27) as num_draft,

(select count(project_id) from project p where tc_direct_project_id = tcd.project_id and p.project_status_id = 1 and p.project_category_id != 27 
                                         and not exists (select project_phase_id from project_phase where project_id = p.project_id and phase_type_id in (2,3))) as num_scheduled,
                                         
(select count(project_id) from project p where tc_direct_project_id = tcd.project_id and p.project_status_id = 1 and p.project_category_id != 27
                                         and exists (select project_phase_id from project_phase where project_id = p.project_id and phase_type_id = 2)) as num_active,
 
(select count(project_id) from project p where tc_direct_project_id = tcd.project_id and p.project_status_id in (7,4,5,6,8) and p.project_category_id != 27) as num_finished,

(select count(project_id) from project p where tc_direct_project_id = tcd.project_id and p.project_status_id in (9,10) and p.project_category_id != 27) as num_cancelled

from tc_direct_project tcd, user_permission_grant upg, corporate_oltp:tc_direct_project_status_lu tcdpsl

where upg.user_id = DECODE(@uid@,0,upg.user_id,@uid@) and upg.resource_id = tcd.project_id and upg.permission_type_id in (0,1,2,3)
and tcdpsl.project_status_id = tcd.project_status_id

order by upper(tcd.name)


